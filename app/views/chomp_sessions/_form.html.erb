<%= simple_form_for(chomp_session,
                    data: {
                      controller: "chomp"
                    }) do |f| %>
  <%= f.input :name, label: "Meeting Name", required: false,
    placeholder: "I can't decide on a name on #{Time.now}",
    input_html: { value: f.object.name || [
    "Chomping since #{Time.now}",
    "Nom nom time",
    "Chomp chomp time",
    "Indecisive Gang",
    "CafÃ© Hoppers",
    "Just need somewhere to shake my legs and wag my tongue",
    "I can't decide on a name",
    "What is life?",
    "Anything la", "Whatever la",
    "Can Chomp decide on a name for me, please?",
    "Turtles are cute",
    "Cats > Dogs",
    "Dogs > Cats"
    ].sample,
    id: "chomp-session-name",
    data: { chomp_target: "name", action: "keyup->chomp#autofillTime" },
    onClick: "this.setSelectionRange(0, this.value.length)" } %>
  <%= f.input :date, html5: true, min: "#{Date.today.iso8601}"%>
  <%= f.input :time, html5: true, min: "#{Time.now.iso8601}", input_html: { id: "chomp-session-time", data: {chomp_target: "timeOutput"} } %>
  <%= f.input :session_expiry, label:"Link Expiry Time (Hours)", hint: "Set the time that you want your poll to be active" %>

  <label class="integer optional mb-3" for="chomp_session_invitees">Number of Friends (optional)</label>
  <div class="flex-between">
    <a class="btn-success rounded-lg text-white incrementer minus d-flex align-items-center justify-content-center" data-offset="-1">-</a>
    <span id="counter" data-count="1" class="font-weight-bold">1</span>
    <a href="#" class="btn-success rounded-lg text-white incrementer d-flex align-items-center justify-content-center" data-offset="1" type="button">+</a>
  </div>

  <div class="form-group integer optional chomp_session_invitees">
    <input type="number" class="form-control numeric integer optional" placeholder="Optional" step="1" name="chomp_session[invitees]" id="chomp_session_invitees" value="1">
    <div class="invalid-feedback d-block"></div>
  </div>

  <%= f.submit value:"Create Invite Link", class:"btn btn-primary btn-block mt-4" %>

<% end %>

<script>
  var updateCounter = (counter, count) => {
    counter.dataset.count = count;
    counter.innerText = count;
  };

  var updateInput = (count) => {
    let input = document.getElementById('chomp_session_invitees');
    input.value = count;
  };

  var updateForm = (event) => {
    //converting string to integer from clicking on the plus and minus signs
    let offset = Number.parseInt(event.currentTarget.dataset.offset, 10);
    let counter = document.getElementById('counter');
    let count = Number.parseInt(counter.dataset.count, 10) + offset;
    if (count >= 1 ) {
      event.preventDefault();
      updateCounter(counter, count);
      updateInput(count);
    } else {
      event.preventDefault();
    }
  };

  var updateFormOnButtonClick = (button) => {
    button.addEventListener('click', updateForm);
  };

  var buttons = document.querySelectorAll('.incrementer');
  buttons.forEach(updateFormOnButtonClick);
</script>
